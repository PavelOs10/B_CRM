# 💈 BarberCRM v4.0.0 - Профессиональная CRM для барбершопов

> **Мультифилиальная система управления с автоматическим созданием Google Таблиц**

[![Version](https://img.shields.io/badge/version-4.0.0-blue.svg)](https://github.com)
[![Docker](https://img.shields.io/badge/docker-ready-brightgreen.svg)](https://docker.com)
[![Python](https://img.shields.io/badge/python-3.11-blue.svg)](https://python.org)
[![React](https://img.shields.io/badge/react-18-blue.svg)](https://reactjs.org)

---

## 🎯 Что нового в v4.0

### ✅ Основные улучшения:

| Функция | Описание | Статус |
|---------|----------|--------|
| 🏢 Мультифилиальность | Каждый филиал = отдельная Google Таблица | ✅ Реализовано |
| 📊 Исправлен баг оценок | Правильный подсчёт среднего (было: сумма) | ✅ Исправлено |
| 🤖 Автосоздание таблиц | Таблицы создаются автоматически при регистрации | ✅ Реализовано |
| 🔒 Изоляция данных | Полная изоляция данных между филиалами | ✅ Реализовано |

**Подробнее**: См. `CHANGELOG_v4.0.md`

---

## 🚀 Быстрый старт

### 1. Подготовка (5 минут)

```bash
# 1. Создайте главную Google Таблицу
# 2. Скопируйте её ID из URL
# 3. Дайте доступ "Редактор" вашему сервисному аккаунту
```

### 2. Настройка .env

```env
# ID главной таблицы (не рабочей!)
GOOGLE_SHEET_ID=1YourMasterTableId...

# JSON ключ сервисного аккаунта
GOOGLE_SERVICE_ACCOUNT_JSON={"type": "service_account", ...}
```

### 3. Запуск

```bash
docker-compose up -d --build
```

**Готово!** Откройте http://localhost

---

## 📚 Документация

| Документ | Описание |
|----------|----------|
| 📄 [CHANGELOG_v4.0.md](./CHANGELOG_v4.0.md) | Полное описание всех изменений |
| 🚀 [MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md) | Пошаговая миграция с v3.1 |
| 📊 [SUMMARY_v4.0.md](./SUMMARY_v4.0.md) | Сводная таблица изменений |

---

## 🏗️ Архитектура

```
┌─────────────────────────────┐
│   Главная таблица (Master)  │
│   ┌─────────────────────┐   │
│   │ Филиалы:            │   │
│   │ - Центр  → ID1      │───┼──┐
│   │ - Север  → ID2      │───┼──┼──┐
│   │ - Запад  → ID3      │───┼──┼──┼──┐
│   └─────────────────────┘   │  │  │  │
└─────────────────────────────┘  │  │  │
                                 │  │  │
        ┌────────────────────────┘  │  │
        │  ┌────────────────────────┘  │
        │  │  ┌────────────────────────┘
        ▼  ▼  ▼
     ┌────┬────┬────┐
     │ T1 │ T2 │ T3 │  Отдельные таблицы
     └────┴────┴────┘  для каждого филиала
```

---

## 📋 Возможности

### Управление филиалом

- ✅ Утренние мероприятия (цель: 16/мес)
- ✅ Полевые выходы (цель: 4/мес)
- ✅ One-on-One встречи (цель: 6/мес)
- ✅ Еженедельные показатели (цель: 4/мес)
- ✅ Планы мастеров (цель: 10/мес)
- ✅ Отзывы (цель: 60/мес)
- ✅ Адаптация новичков (цель: 10/мес)
- ✅ Сводная отчётность

### Аналитика

- 📊 Дашборд с ключевыми метриками
- 📈 Прогресс выполнения целей
- 🎯 Автоматический расчёт процентов
- 📅 Фильтрация по периодам

---

## 🔧 Технологии

| Компонент | Технология |
|-----------|------------|
| Backend | FastAPI + Python 3.11 |
| Frontend | React 18 + Tailwind CSS |
| База данных | Google Sheets |
| Деплой | Docker + Docker Compose |
| API | Google Sheets API + Drive API |

---

## 📊 Пример: Подсчёт оценки

### ❌ Было (v3.1):
```
Оценки: 10, 10, 10, 10, 10
Результат: 50/10 (сумма)
```

### ✅ Стало (v4.0):
```
Оценки: 10, 10, 10, 10, 10
Результат: 10.0/10 (среднее)
```

---

## 🔒 Безопасность

- 🔐 Пароли хешируются (SHA-256)
- 🎫 Токен-аутентификация
- 🏢 Изоляция данных между филиалами
- 📁 Каждый филиал = отдельная таблица

---

## 📞 Поддержка

### Проблемы?

1. **Проверьте логи**:
   ```bash
   docker-compose logs backend
   ```

2. **Проверьте доступы**:
   - Сервисный аккаунт имеет доступ к главной таблице
   - Включены Google Sheets API и Drive API

3. **Проверьте .env**:
   - `GOOGLE_SHEET_ID` = ID главной таблицы
   - `GOOGLE_SERVICE_ACCOUNT_JSON` корректен

### Частые ошибки

| Ошибка | Решение |
|--------|---------|
| "Permission denied" | Дайте доступ сервисному аккаунту к таблице |
| "API not enabled" | Включите Google Drive API в консоли |
| "Филиал не найден" | Проверьте GOOGLE_SHEET_ID в .env |

**Подробнее**: См. `CHANGELOG_v4.0.md` → раздел "Решение проблем"

---

## 🗺️ Roadmap

### v4.1 (март 2026)
- [ ] Кэширование Spreadsheet ID
- [ ] Rate limiting
- [ ] Расширенное логирование

### v4.2 (апрель 2026)
- [ ] Рефакторинг фронтенда на модули
- [ ] Unit-тесты для бэкенда
- [ ] Экспорт в Excel/PDF

### v5.0 (лето 2026)
- [ ] Система ролей
- [ ] Мобильное приложение
- [ ] Интеграция с 1C

---

## 👥 Авторы

- **Разработка**: @IDDQD11
- **Обновление v4.0**: Claude AI Assistant
- **Дата релиза**: Февраль 14, 2026

---

## 📄 Лицензия

Проприетарное ПО. Все права защищены.

---

## 🙏 Благодарности

Спасибо всем, кто использует BarberCRM и помогает делать его лучше!

---

**Нужна помощь?** Прочитайте [MIGRATION_GUIDE.md](./MIGRATION_GUIDE.md)

**Хотите узнать больше?** См. [CHANGELOG_v4.0.md](./CHANGELOG_v4.0.md)
